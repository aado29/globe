
<!DOCTYPE html>
<html>
<head>
<script src="http://code.jquery.com/jquery-1.7.1.js" type="text/javascript"></script>
<script src="http://code.brianmokeefe.com/Graph.js" type="text/javascript"></script>
<style type="text/css">
	.hidden {
		display: none;
	}
	#divCanvas {
		position: absolute;
		top: 30px;
		left: 0px;
		width: 100%;
		height: 100%;
	}
</style>
<title>Graph Viewer</title>
</head>
<body>
<div id="divCanvas">
</div>

<script type="text/javascript">
var _manager;
var _nodeInstanceCounter = 1;
var _stateMachine;
var stage = $('#divCanvas');


$(document).ready(function () {
	
	_manager = new Graph.Manager(
			'divCanvas',
			stage.width(),
			stage.height()
	);
	
	_manager.registerListeners();
	
	_stateMachine = new StateMachine();
	_stateMachine.select();
	
	var lastNode = null;
	
	// Add 10 nodes with edges between subsequent nodes
	for(var i=0; i<10; i++) {
		var r = Math.floor(Math.random() * 225);
		var g = Math.floor(Math.random() * 225);
		var b = Math.floor(Math.random() * 225);
		var color = 'rgb(' + r + ',' + g + ',' + b + ')';
		
		var node = addNode(color, Math.floor(Math.random() * stage.width()), Math.floor(Math.random() * stage.height()), Math.floor(Math.random() * 20));
		
		if (lastNode != null) {
			_manager.addEdge(lastNode, node);
		}
		lastNode = node;
	}
	
	_manager.paint();
	
});

function addNode(color, x, y, size) {
	return _manager.addNode(color, new Graph.Coordinates(x, y), size);
}

function doSelectMouseOver(evt, manager) {
	if (manager.hitTest(evt) != null) {
		$('#divCanvas').css('cursor', 'pointer');
	} else {
		$('#divCanvas').css('cursor', 'auto');
	}
}

function doSelectDragMouseDown(evt, manager) {
	if (!(_stateMachine.subState == 'Dragging')) {
		var hits = manager.hitTest(evt);
		if (hits != null) {
		 	_stateMachine.subState = 'Dragging';
		 	_stateMachine.data = hits[0];
		}
	}
}

function doSelectDragMouseUp(evt, manager) {
	if (_stateMachine.subState == 'Dragging' && _stateMachine.data != null) {
		_stateMachine.data.getNode().setPosition(evt.offsetX - _stateMachine.data.getOffset().x, evt.offsetY - _stateMachine.data.getOffset().y);
	}
	_stateMachine.subState = 'None';
	_stateMachine.data = null;
	manager.paint();
}

function doSelectDragMouseMove(evt, manager) {
	if (_stateMachine.subState == 'Dragging' && _stateMachine.data != null) {
		_stateMachine.data.getNode().setPosition(evt.offsetX - _stateMachine.data.getOffset().x, evt.offsetY - _stateMachine.data.getOffset().y);
	}
	manager.paint();
}

var StateMachine = function() {
	this.subState = 'None';
	this.data = null;
	this.select = function(){
		this.subState = 'None';
		_manager.clearEventListeners('mousedown');
		_manager.clearEventListeners('mouseup');
		_manager.clearEventListeners('mousemove');
		_manager.clearEventListeners('mouseover');
		_manager.addEventListener('mousedown', doSelectDragMouseDown);
		_manager.addEventListener('mouseup', doSelectDragMouseUp);
		_manager.addEventListener('mousemove', doSelectDragMouseMove);
		_manager.addEventListener('mousemove', doSelectMouseOver);
	};
}


</script>
</body>
</html>